### 용어정리
> 경쟁상태
공유 자원을 둘 이상의 프로세스 또는 스레드가 동시에 읽거나 쓰는 상황을 말하며 동시에 접근을 시도할 떄의 타이밍이 예상되는 결과 값에 영향을 줄 수 있는 상태
> 

> 임계 영역 (Critical Section)
여러 프로세스나 스레드가 **공유 자원에 접근하거나 수정하는 코드 영역**입니다. 여기에서는 동시에 여러 스레드가 접근할 경우 **데이터 충돌**이나 **일관성 문제**가 발생할 수 있기 때문에, 반드시 **동기화가 필요**
> 

> 무한 대기
> 
> 
> 특정 프로세스가 영원히 임계 영역에 들어가지 못하게 하는 것
> 

> 안전순서열
안전순서열은 교착 상태를 방지하기 위한 개념으로, 모든 프로세스가 요구하는 자원을 안전하게 할당할 수 있는 프로세스 실행 순서
> 

```bash
프로세스 간 메시지를 전송하거나, 공유메모리를 통해 공유된 자원에 여러 개의 프로세스가 동시에 접근하면 경쟁상태 발생할 수 있음

경쟁상태를 해결하기 위한 동기화 조건,기법을 알아보자
```

## 01 동기화 조건

### 1.1 상호 배제 (Mutual Exclusion)

- 한 프로세스가 임계 영역에 들어갔을 때 다른 프로세스는 들어갈 수 없음

  - e.g. 은행 계좌 잔액을 동시에 여러 스레드가 업데이트하는 상황

상호 배제를 통해 한 스레드가 업데이트를 완료한 후에만 다른 스레드가 접근하도록 제어

### 1.2 한정 대기 (Bounded Waiting)

- 특정 프로세스가 임계영역 진입을 요청한 후 해당 요청이 승인되기 전까지 다른 프로세스가 임계영역에 진입하는 횟수를 제한함. 이를 통해 무한대기를 방지

### 1.3 진행 보장 (Progress)

- 만약 어떠한 프로세스도 임계영역을 사용하지 않는다면 임계영역 외부의 어떠한 프로세스도 들어갈 수 있으며 이 때 프로세스끼리 서로 방해하지 않는 것을 말함

```bash
프로세스 간 메시지를 전송하거나, 공유메모리를 통해 공유된 자원에 여러 개의 프로세스가 동시에 접근하면 경쟁상태 발생할 수 있음

경쟁상태를 해결하기 위한 동기화 기법을 알아보자
```

## 02 동기화 기법

### 2.1 Mutex

![image](https://github.com/user-attachments/assets/43f3d61e-05f2-408f-93aa-54ddc363e0f6)

- **Mut**ual **Ex**clusion의 약자
- 프로세스나 스레드를 상호 배제 하기 위해 사
- **동작 원리**
    - **한 번에 하나의 프로세스만 접근할 수 있도록 제어\**
    - 프로세스가 공유 자원 접근시, 먼저 뮤텍스를 잠그고(lock) → 작업이 끝나면 뮤텍스를 해제(unlock)
    - 한 프로세스가 뮤텍스를 잠그고 있으면 다른 프로세스는 접근이 불가능, 반드시 락을 가진 프로세스만 잠금을 해제할 수 있음

### 2.2 Semaphore

![image](https://github.com/user-attachments/assets/e3f390c6-55f1-444a-81c0-aafbc99eb7d2)

- 여러 프로세스가 **동시에 공유 자원에 접근할 수 있도록 허용**하는 동기화 기법
- 동작 원리
    - **카운터**로 작동하여, 현재 접근 가능한 자원의 수를 나타냅니다.
    - 이진 세마포어(Binary Semaphore)
        - 뮤텍스처럼 0과 1의 값만 가짐
        - 하나의 프로세스만 접근 가능
    - 카운팅 세마포어(Counting Semaphore)
        - 특정한 수만큼의 프로세스가 자원에 접근할 수 있도록 허용
        - e.g. DB 연결 풀에서 최대 N개의 연결을 허용하려는 경우, 카운팅 세마포어를 사용해 특정 개수의 프로세스만 자원에 접근하도록 제한

### 2.3 Monitor
![image](https://github.com/user-attachments/assets/ddeac404-d669-47f8-937a-c8607012e548)


- 뮤텍스와 조건 변수를 결합한 고수준 동기화 기법
- 자원의 접근을 관리하는 특정 코드 블록(객체), 인터페이스만 제공
- **동작 원리**
    - 모니터는 객체 내에서만 접근할 수 있는 공유 자원과 메서드를 감싸고, 모니터 내부에서 하나의 프로세스만 접근할 수 있게 제한
    - 프로세스는 모니터가 잠금 상태일 때 진입하려면 대기 필요
    - 작업이 끝나면 다른 대기 중인 프로세스가 들어갈 수 있도록 허용
    - 모니터는 뮤텍스와 조건 변수(Condition Variable)로 구현되며, 이를 통해 자원의 상태를 확인하고 특정 조건에서만 실행되도록 제어
    - e.g. Java의 `synchronized` 키워드가 모니터 역할을 하며, 특정 메서드나 블록에 한 번에 하나의 스레드만 접근 가능
- Monitor와 Semaphore의 차이
    - Monitor
        - 한번에 하나의 프로세스만 공유자원에 접근
        - 상호배제가 자동
    - Semaphore
        - 한번에 여러개 프로세스가 공유자원에 접근 가능
        - 정수변수 기반 상호배제 명시적 구현 필요

## 03 교착 상태 (deadlock)

![image](https://github.com/user-attachments/assets/a334530f-a49e-45b7-a29e-abb5559ccf20)

```bash
두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태
```

### 3.1 교착상태 원인

```bash
아래 4가지 조건이 모두 충족되어야 교착상태 발생
```

- 상호 배제
- 점유 대기
- 비선점 : 다른 프로세스의 자원을 강제적으로 가져올 수 없음
- 환형 대기
    - 프로세스 A는 프로세스B의 자원 요구, B는 A자원을 요구하는 상황

### 3.2 교착 상태 해결 방법

- 교착상태 조건이 성립하지 않도록 설계
- 교착상태 처리 비용이 크기 때문에 사용자 작업 강제 종료 유도
    - e.g. 응답없음 메세지 박스
- 은행원 알고리즘을 통한 자원 할당
    - 프로세스당 요청할 자원들의 최대치를 통해 자원 할당가능 여부 판악

### 3.3 은행원 알고리즘 (banker’s algorithm)

- 교착상태를 회피함
- 동작원리
    - 총 자원의 양과 현재 할당한 자원의 양을 기준으로 안정 or 불안정 상태로 나눔
        - 안정상태
            - 교착을 일으키지 않고, 각 프로세스가 요구한 양 만큼 자원을 할당해줄 수 있는 안전 순서열이 존재하는 상태
        - 불안정상태
            - 프로세스가 요구한 양만큼 자원 할당이 불가해 안전순서열이 존재하지 않는 상태
    - 안정 상태로 가도록 자원 할당
- 단점
    - 프로세스가 시스템에 들어갈 때 필요한 최대 자원 수 예측이 어려움

[참고] [🔗](https://velog.io/@minu-j/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EB%A7%8C%ED%99%94%EB%A1%9C-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-%EC%9D%80%ED%96%89%EC%9B%90-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98-%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C-%ED%9A%8C%ED%94%BC-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98) 은행원 알고리즘 만화로 이해하기
