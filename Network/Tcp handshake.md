# [TCP] 3 way handshake & 4 way handshake


### μ©μ–΄ μ •λ¦¬

> **SYN ν¨ν‚·**
> 
> 
> TCP μ—°κ²° μ„¤μ • κ³Όμ •μ—μ„ μ‚¬μ©λλ” νΉλ³„ν• ν¨ν‚·μ…λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ™€μ μ—°κ²°μ„ μ‹μ‘ν•κΈ° μ„ν•΄ λ³΄λ‚΄λ” μ²« λ²μ§Έ λ©”μ‹μ§€λ΅, μ—°κ²° μ”μ²­μ„ λ‚νƒ€λƒ…λ‹λ‹¤.
> 

> **ACK(Acknowledgment)**
> 
> 
> TCP ν”„λ΅ν† μ½μ—μ„ λ°μ΄ν„° μμ‹ μ„ ν™•μΈν•λ” μ‹ νΈμ…λ‹λ‹¤. 3-way handshake κ³Όμ •μ—μ„ μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ μ—°κ²° μ”μ²­μ„ λ°›μ•μμ„ μ•λ¦¬λ” λ° μ‚¬μ©λ©λ‹λ‹¤.
> 

> **FIN ν”λκ·Έ**
> 
> 
> TCP μ—°κ²° μΆ…λ£ κ³Όμ •μ—μ„ μ‚¬μ©λλ” νΉλ³„ν• μ‹ νΈμ…λ‹λ‹¤. μ΄λ” ν• μ½μ΄ μ—°κ²°μ„ μΆ…λ£ν•κ³ μ ν•  λ• μƒλ€λ°©μ—κ² λ³΄λ‚΄λ” λ©”μ‹μ§€λ΅, λ” μ΄μƒ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•μ§€ μ•κ² λ‹¤λ” μμ‚¬λ¥Ό λ‚νƒ€λƒ…λ‹λ‹¤.
> 

<br>

### **3 way handshake - μ—°κ²° μ„±λ¦½**

> TCPλ” μ •ν™•ν• μ „μ†΅μ„ λ³΄μ¥ν•΄μ•Ό ν•λ‹¤. λ”°λΌμ„ ν†µμ‹ ν•κΈ°μ— μ•μ„, λ…Όλ¦¬μ μΈ μ ‘μ†μ„ μ„±λ¦½ν•κΈ° μ„ν•΄ 3 way handshake κ³Όμ •μ„ μ§„ν–‰ν•λ‹¤.

![Untitled_-_3-way_handshake](https://github.com/user-attachments/assets/dcb8cfb6-bade-41d1-ae1f-b06374cf016e)

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² SYN ν¨ν‚·μ„ λ³΄λƒ„ (sequence : x)
>
2. μ„λ²„κ°€ SYN(x)μ„ λ°›κ³ , ν΄λΌμ΄μ–ΈνΈλ΅ λ°›μ•λ‹¤λ” μ‹ νΈμΈ ACKμ™€ SYN ν¨ν‚·μ„ λ³΄λƒ„ (sequence : y, ACK : x + 1)
>
3. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ μ‘λ‹µμ€ ACK(x+1)μ™€ SYN(y) ν¨ν‚·μ„ λ°›κ³ , ACK(y+1)λ¥Ό μ„λ²„λ΅ λ³΄λƒ„
<br>
μ΄λ ‡κ² 3λ²μ ν†µμ‹ μ΄ μ™„λ£λλ©΄ μ—°κ²°μ΄ μ„±λ¦½λλ‹¤. μ΄ ν›„ κ³Όμ •μ€ ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μΌλ΅ μ‹μ‘λλ‹¤. seq, ACK κ°’μ„ μ£Όκ³  λ°›μΌλ©° +1 λλ” μ΄μ λ” λ³΄μ•κ³Ό κ΄€λ ¨μ΄ μλ‹¤. μ΄ κ°’μ„ κ³„μ‚°ν•΄μ„ ν†µμ‹ μ„ κ°€λ΅μ±„λ”κ²ƒμ„ μ„Έμ… ν•μ΄μ¬ν‚Ήμ΄λΌκ³  ν•λ‹¤.

<br>

### **4 way handshake - μ—°κ²° ν•΄μ **

> μ—°κ²° μ„±λ¦½ ν›„, λ¨λ“  ν†µμ‹ μ΄ λλ‚¬λ‹¤λ©΄ ν•΄μ ν•΄μ•Ό ν•λ‹¤.

![Untitled_-_4-way_handshake_(1)](https://github.com/user-attachments/assets/5dff8da7-dfac-498f-8f46-db7a4f2a6c6e)

1. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ—κ² μ—°κ²°μ„ μΆ…λ£ν•λ‹¤λ” FIN ν”λκ·Έλ¥Ό λ³΄λ‚Έλ‹¤.

2. μ„λ²„λ” FINμ„ λ°›κ³ , ν™•μΈν–λ‹¤λ” ACKλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Έλ‹¤. 
    - μ΄λ• λ¨λ“  λ°μ΄ν„°λ¥Ό λ³΄λ‚΄κΈ° μ„ν•΄ CLOSE_WAIT μƒνƒκ°€ λλ‹¤)

3. λ°μ΄ν„°λ¥Ό λ¨λ‘ λ³΄λƒλ‹¤λ©΄, μ—°κ²°μ΄ μΆ…λ£λμ—λ‹¤λ” FIN ν”λκ·Έλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Έλ‹¤.

4. ν΄λΌμ΄μ–ΈνΈλ” FINμ„ λ°›κ³ , ν™•μΈν–λ‹¤λ” ACKλ¥Ό μ„λ²„μ—κ² λ³΄λ‚Έλ‹¤. 

    - Q. Serverμ—μ„ FINμ„ μ „μ†΅ μ „μ— λ³΄λ‚Έ ν¨ν‚·μ΄ FINν¨ν‚·λ³΄λ‹¤ λ¦κ² λ„μ°©ν•λ‹¤λ©΄?

        - μ΄ ν¨ν‚·μ€ Drop, λ°μ΄ν„°λ” μ μ‹¤

        - ν•΄κ²° λ°©λ²• : TIME_WAIT

            - Clientλ” Serverλ΅λ¶€ν„° FINμ„ μμ‹ ν•λ”λΌλ„ μΌμ •μ‹κ°„(λ””ν΄νΈ 240μ΄) λ™μ• μ„Έμ…μ„ λ‚¨κ²¨λ†“κ³  μ‰μ—¬ ν¨ν‚·μ„ κΈ°λ‹¤λ¦¬λ” κ³Όμ •

    - μ„λ²„λ” ACKλ¥Ό λ°›μ€ μ΄ν›„ μ†μΌ“μ„ λ‹«λ”λ‹¤

    - TIME_WAIT μ‹κ°„μ΄ λλ‚λ©΄ ν΄λΌμ΄μ–ΈνΈλ„ λ‹«λ”λ‹¤

<br>
μ΄λ ‡κ² 4λ²μ ν†µμ‹ μ΄ μ™„λ£λλ©΄ μ—°κ²°μ΄ ν•΄μ λλ‹¤.
<br><br><br>
[μ°Έκ³ μλ£]

[π”—](https://www.youtube.com/watch?v=Ah4-MWISel8) [λ”°λΌε­ΈIT] 09. μ—°κ²°μ§€ν–¥ν• TCP ν”„λ΅ν† μ½ - TCP 3Way Handshake

[π”—](https://mindnet.tistory.com/entry/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-22%ED%8E%B8-TCP-3-WayHandshake-4-WayHandshake) [ λ„¤νΈμ›ν¬ μ‰½κ² μ΄ν•΄ν•κΈ° 22νΈ ] TCP 3 Way-Handshake & 4 Way-Handshake

[π”—](https://www.youtube.com/watch?v=K9L9YZhEjC0) μ΄ν•΄ν•λ©΄ μΈμƒμ΄ λ°”λ€λ” TCP μ†΅/μμ‹  μ›λ¦¬
